#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ –Ω–∞ VPS

echo "üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞..."
echo "===================================="

# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä–æ–≥–æ –±–æ—Ç–∞
echo "‚èπÔ∏è  –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä–æ–≥–æ –±–æ—Ç–∞..."
pkill -9 python3
sleep 2

# 2. –°–∫–∞—á–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–¥
echo "üì• –°–∫–∞—á–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è..."
cd ~/dota2_lobby_bot
git pull

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º .env —Ñ–∞–π–ª
echo "üîß –ü—Ä–æ–≤–µ—Ä—è–µ–º .env —Ñ–∞–π–ª..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ NOTIFICATION_CHAT_ID
if ! grep -q "NOTIFICATION_CHAT_ID" .env; then
    echo "‚ûï –î–æ–±–∞–≤–ª—è–µ–º NOTIFICATION_CHAT_ID..."
    echo "" >> .env
    echo "# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É" >> .env
    echo "NOTIFICATION_CHAT_ID=-1003106019461" >> .env
else
    echo "‚úÖ NOTIFICATION_CHAT_ID —É–∂–µ –µ—Å—Ç—å"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ NOTIFICATION_THREAD_ID
if ! grep -q "NOTIFICATION_THREAD_ID" .env; then
    echo "‚ûï –î–æ–±–∞–≤–ª—è–µ–º NOTIFICATION_THREAD_ID..."
    echo "NOTIFICATION_THREAD_ID=37" >> .env
else
    echo "‚úÖ NOTIFICATION_THREAD_ID —É–∂–µ –µ—Å—Ç—å"
fi

# 4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
source venv/bin/activate
pip install -q -r requirements.txt

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ –±–æ—Ç–∞..."
python3 main.py

echo "===================================="
echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"

